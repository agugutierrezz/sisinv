<div class="container">
  <% archived = article_archived?(@article) %>

  <div class="page-head">
    <div>
      <a href="<%= articles_path %>" class="back-link">← Volver a Artículos</a>
      <h1 class="page-title"><%= @article.identificador %></h1>
      <% if archived %>
        <p class="muted" style="margin:6px 0 0;">
          <span class="badge badge-archived">Artículo archivado</span> · Solo lectura
        </p>
      <% end %>
      <p class="muted"><%= @article.marca&.nombre %> – <%= @article.modelo&.nombre %></p>
    </div>

    <% unless archived %>
      <%= link_to "Nueva Transferencia",
                  new_transfer_path(article_id: @article.id),
                  class: "btn btn-primary btn-with-icon" %>
    <% end %>
  </div>

  <div class="card">
    <div class="section-head" style="display:flex;align-items:center;justify-content:space-between;">
      <h3 style="margin:0;">Datos Básicos</h3>

      <% unless archived %>
        <div class="head-actions">
          <%= link_to edit_article_path(@article["id"] || @article.id),
                      class: "icon-btn", title: "Editar artículo" do %>
            <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/></svg>
            <span class="sr-only">Editar</span>
          <% end %>
        </div>
      <% end %>
    </div>

    <div class="form-grid" style="grid-template-columns:1fr 1fr;">
      <div class="form-row">
        <label>Identificador</label>
        <div class="input"><%= @article.identificador %></div>
      </div>

      <div class="form-row">
        <label>Marca</label>
        <div class="input"><%= @article.marca&.nombre %></div>
      </div>

      <div class="form-row">
        <label>Modelo</label>
        <div class="input"><%= @article.modelo&.nombre %></div>
      </div>

      <div class="form-row">
        <label>Fecha de Ingreso</label>
        <div class="input"><%= @article.fecha_ingreso %></div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:16px;">
    <h3 style="margin:0 0 10px 0;">Historial de Portadores</h3>

    <% if @transferencias.any? %>
      <ul style="list-style:none;padding:0;margin:0;display:grid;gap:10px">
        <% @transferencias.each do |t| %>
          <li class="card" style="padding:12px">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
              <div>
                <strong><%= [t.persona&.nombre, t.persona&.apellido].compact.join(" ") %></strong>
                <% if t.actual %>
                  <span class="badge" style="margin-left:8px;">Portador Actual</span>
                <% end %>
              </div>
              <div class="muted">
                <%= t.fecha.present? ? Date.parse(t.fecha.to_s).strftime("%d/%m/%Y") : "—" %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="muted">Este artículo no tuvo portadores.</p>
    <% end %>
  </div>
</div>
